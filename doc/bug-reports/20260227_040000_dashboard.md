# Bug Report — SRE(Site Reliability Engineering) 대시보드(Dashboard) 버그 8건

- **작성일시(Timestamp)**: 2026-02-27 04:00 KST(Korean Standard Time)
- **환경(Environment)**: M4 Max MacBook Pro, Node.js + TypeScript, React 19 + Vite 7
- **컴포넌트(Component)**: `dashboard/` — SRE 운영 대시보드(Operations Dashboard)

---

## BUG-001: ESM(ECMAScript Module) `__dirname` 미정의(Undefined)

| 항목(Field) | 내용(Detail) |
|------|------|
| 타임스탬프(Timestamp) | 2026-02-27 04:00 |
| 심각도(Severity) | Medium |
| 카테고리(Category) | 런타임(Runtime) |

### 증상(Symptom)
```
ReferenceError: __dirname is not defined in ES module scope
```

### 원인(Root Cause)
`package.json`에 `"type": "module"` 설정으로 ESM(ECMAScript Module) 모드에서 실행. ESM에서는 `__dirname`과 `__filename`이 정의되지 않음.

### 해결(Fix)
```typescript
// Before — CJS(CommonJS) only
const configPath = path.join(__dirname, '../../config/clusters.json');

// After — ESM compatible
import { fileURLToPath } from 'url';
import { dirname } from 'path';
const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
```

### 수정 파일(Modified Files)
- `dashboard/server/config.ts`

### 교훈(Lesson)
ESM(`"type": "module"`)에서는 `__dirname`, `__filename`, `require`가 없음. `import.meta.url`과 `fileURLToPath`를 사용.

---

## BUG-002: `tart list` 상태 컬럼(Column) 파싱(Parsing) 오류

| 항목(Field) | 내용(Detail) |
|------|------|
| 타임스탬프(Timestamp) | 2026-02-27 04:15 |
| 심각도(Severity) | Medium |
| 카테고리(Category) | 데이터 수집(Data Collection) |

### 증상(Symptom)
모든 VM(Virtual Machine) 상태가 "20"으로 표시됨 (실제로는 running/stopped).

### 원인(Root Cause)
`tart list` 출력의 "Accessed" 컬럼이 "30m ago"처럼 공백 포함하여 `split` 결과가 가변적. 고정 인덱스(Fixed Index) 3으로 State를 파싱했으나, 실제로는 "Disk" 컬럼(값: 20)이 선택됨.

### 해결(Fix)
```typescript
// Before (wrong column index)
const state = parts[3];

// After (always last column)
const state = parts[parts.length - 1];
```

### 수정 파일(Modified Files)
- `dashboard/server/collectors/tart.ts`

### 교훈(Lesson)
CLI(Command Line Interface) 출력 파싱 시 고정 인덱스 의존은 위험. 공백 포함 컬럼이 `split` 결과를 변동시킴. 마지막 컬럼이나 헤더 기반 파싱이 안전.

---

## BUG-003: `tart ip` 전체 null 반환

| 항목(Field) | 내용(Detail) |
|------|------|
| 타임스탬프(Timestamp) | 2026-02-27 04:30 |
| 심각도(Severity) | High |
| 카테고리(Category) | VM(Virtual Machine) |

### 증상(Symptom)
```
[collector] 7 VMs found, but all IPs are null
```

### 원인(Root Cause)
이전 세션에서 VM이 비정상 종료(Abnormal Termination). `tart list`에서 running으로 표시되지만 실제 프로세스(Process)는 없는 좀비(Zombie) 상태.

### 해결(Fix)
```bash
./scripts/shutdown.sh    # 정상 종료(Graceful Shutdown)
./scripts/boot.sh        # 재시작(Restart)
```

### 교훈(Lesson)
Tart VM은 호스트(Host) 재부팅 시 프로세스가 종료되지만 상태 파일(State File)은 "running"으로 남을 수 있음. 대시보드에서는 `tart ip` 실패를 그레이스풀(Gracefully)하게 처리해야 함.

---

## BUG-004: `boot.sh` SCRIPT_DIR 변수(Variable) 충돌

| 항목(Field) | 내용(Detail) |
|------|------|
| 타임스탬프(Timestamp) | 2026-02-27 04:45 |
| 심각도(Severity) | Medium |
| 카테고리(Category) | 스크립트(Script) |

### 증상(Symptom)
```
bash: /Users/ywlee/tart-infra/scripts/lib/boot/01-start-vms.sh: No such file or directory
```

### 원인(Root Cause)
`boot.sh`와 `scripts/lib/common.sh` 둘 다 `SCRIPT_DIR` 변수를 정의. `common.sh`가 `source`되면서 `boot.sh`의 `SCRIPT_DIR`을 덮어쓰기(Overwrite)하여 경로(Path)가 잘못 해석됨.

### 해결(Fix)
```bash
# Before (common.sh)
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# After (common.sh) — underscore prefix로 네임스페이스(Namespace) 분리
_COMMON_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
```

### 수정 파일(Modified Files)
- `scripts/lib/common.sh` — 변수명 `SCRIPT_DIR` → `_COMMON_DIR`

### 교훈(Lesson)
`source`로 여러 스크립트를 로드할 때 전역 변수명(Global Variable) 충돌 주의. 라이브러리 스크립트는 `_` 접두사(Prefix)를 사용.

---

## BUG-005: Tailwind CSS 동적 클래스(Dynamic Class) 컴파일 불가

| 항목(Field) | 내용(Detail) |
|------|------|
| 타임스탬프(Timestamp) | 2026-02-27 05:00 |
| 심각도(Severity) | Low |
| 카테고리(Category) | 프론트엔드(Frontend) |

### 증상(Symptom)
런타임(Runtime)에 생성되는 CSS 클래스가 적용되지 않음.

### 원인(Root Cause)
`bg-${status.bg}/10` 형태로 런타임에 생성되는 클래스는 Tailwind의 JIT(Just-In-Time) 컴파일러가 감지 불가.

### 해결(Fix)
```typescript
// Before — 동적 생성(Dynamic Generation)
bgClass: `bg-${color}/10`

// After — 정적 문자열(Static String)
bgClass: 'bg-blue-400/10'
```

---

## BUG-006: 지속시간(Duration) 파싱 NaN

| 항목(Field) | 내용(Detail) |
|------|------|
| 타임스탬프(Timestamp) | 2026-02-27 05:10 |
| 심각도(Severity) | Medium |
| 카테고리(Category) | 백엔드(Backend) |

### 증상(Symptom)
테스트 진행률(Progress)이 NaN으로 표시.

### 원인(Root Cause)
`parseInt('1m')` → `NaN` (숫자가 아닌 접미사)

### 해결(Fix)
`parseDurationSec()` 함수 추가 — `s`/`m`/`h` 접미사(Suffix) 처리.

---

## BUG-007: Vite 포트(Port) 충돌

| 항목(Field) | 내용(Detail) |
|------|------|
| 타임스탬프(Timestamp) | 2026-02-27 05:20 |
| 심각도(Severity) | Medium |
| 카테고리(Category) | 개발 환경(Dev Environment) |

### 증상(Symptom)
Vite가 3001 포트로 폴백(Fallback)하여 Express 서버와 충돌.

### 원인(Root Cause)
좀비 프로세스(Zombie Process)가 3000 포트 점유.

### 해결(Fix)
`vite.config.ts`에 `strictPort: true` 설정 — 포트 점유 시 명시적 에러(Explicit Error) 발생.

---

## BUG-008: CiliumNetworkPolicy가 k6 트래픽 차단(Block)

| 항목(Field) | 내용(Detail) |
|------|------|
| 타임스탬프(Timestamp) | 2026-02-27 05:30 |
| 심각도(Severity) | High |
| 카테고리(Category) | 네트워크 보안(Network Security) |

### 증상(Symptom)
k6 부하 테스트(Load Test)에서 모든 요청(Request)이 타임아웃(Timeout).

### 원인(Root Cause)
demo 네임스페이스의 `default-deny` CiliumNetworkPolicy가 k6 Pod의 이그레스(Egress) 차단.

### 해결(Fix)
테스트 Job 생성 시 `sre-test: "true"` 라벨(Label) 기반 CiliumNetworkPolicy 자동 적용 — 전체 이그레스(Egress) + 인그레스(Ingress) 허용.

### 수정 파일(Modified Files)
- `dashboard/server/jobs.ts` — 테스트 실행 시 NetworkPolicy 자동 생성

### 교훈(Lesson)
제로 트러스트(Zero Trust) 환경에서 테스트 도구도 네트워크 정책(Network Policy) 예외(Exception) 규칙이 필요.

---

## 버그 통계(Bug Statistics)

| 카테고리(Category) | 건수(Count) | 심각도(Severity) |
|----------|------|----------|
| VM(Virtual Machine) / 런타임(Runtime) | 2 | High: 1, Medium: 1 |
| 데이터 수집(Data Collection) | 1 | Medium: 1 |
| 스크립트(Script) | 1 | Medium: 1 |
| 프론트엔드(Frontend) / 개발 환경(Dev Env) | 3 | Medium: 2, Low: 1 |
| 네트워크 보안(Network Security) | 1 | High: 1 |
| **합계(Total)** | **8** | High: 2, Medium: 4, Low: 1 |
